{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Vlad/Desktop/sliding-puzzle-app-main/sliding-puzzle-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/Vlad/Desktop/sliding-puzzle-app-main/sliding-puzzle-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/Vlad/Desktop/sliding-puzzle-app-main/sliding-puzzle-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Vlad/Desktop/sliding-puzzle-app-main/sliding-puzzle-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{projectStorage,projectFirestore,auth}from'../firebase';var useStorage=function useStorage(file){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),progress=_useState2[0],setProgress=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),url=_useState6[0],setUrl=_useState6[1];//uoploads the image to the Firebase Storage \nuseEffect(function(){var currentUserId=auth.currentUser.uid;var storageRef=projectStorage.ref(file.name);storageRef.put(file).on('state_changed',function(snap){var percentage=snap.bytesTransferred/snap.totalBytes*100;setProgress(percentage);},function(err){setError(err);},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,createdAt,currentUserData,images;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return storageRef.getDownloadURL();case 2:url=_context.sent;createdAt=new Date().getTime();_context.next=6;return projectFirestore.collection('users').doc(currentUserId).get();case 6:currentUserData=_context.sent.data();images=currentUserData.images;console.log(currentUserData);_context.next=11;return projectFirestore.collection('users').doc(currentUserId).set({images:[].concat(_toConsumableArray(images),[{url:url,createdAt:createdAt}])});case 11:setUrl(url);case 12:case\"end\":return _context.stop();}}},_callee);})));},[file]);return{progress:progress,url:url,error:error};};export default useStorage;","map":{"version":3,"sources":["C:/Users/Vlad/Desktop/sliding-puzzle-app-main/sliding-puzzle-app/src/hooks/useStorage.js"],"names":["useState","useEffect","projectStorage","projectFirestore","auth","useStorage","file","progress","setProgress","error","setError","url","setUrl","currentUserId","currentUser","uid","storageRef","ref","name","put","on","snap","percentage","bytesTransferred","totalBytes","err","getDownloadURL","createdAt","Date","getTime","collection","doc","get","currentUserData","data","images","console","log","set"],"mappings":"iuBAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,cAAT,CAAyBC,gBAAzB,CAA2CC,IAA3C,KAAuD,aAAvD,CAEA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,IAAD,CAAU,CAC3B,cAAgCN,QAAQ,CAAC,CAAD,CAAxC,wCAAOO,QAAP,eAAiBC,WAAjB,eACA,eAA0BR,QAAQ,CAAC,IAAD,CAAlC,yCAAOS,KAAP,eAAcC,QAAd,eACA,eAAsBV,QAAQ,CAAC,IAAD,CAA9B,yCAAOW,GAAP,eAAYC,MAAZ,eAEA;AACCX,SAAS,CAAC,UAAM,CACf,GAAMY,CAAAA,aAAa,CAAGT,IAAI,CAACU,WAAL,CAAiBC,GAAvC,CACA,GAAMC,CAAAA,UAAU,CAAGd,cAAc,CAACe,GAAf,CAAmBX,IAAI,CAACY,IAAxB,CAAnB,CAEAF,UAAU,CAACG,GAAX,CAAeb,IAAf,EAAqBc,EAArB,CAAwB,eAAxB,CAAyC,SAACC,IAAD,CAAU,CACjD,GAAIC,CAAAA,UAAU,CAAID,IAAI,CAACE,gBAAL,CAAwBF,IAAI,CAACG,UAA9B,CAA4C,GAA7D,CACAhB,WAAW,CAACc,UAAD,CAAX,CACD,CAHD,CAGG,SAACG,GAAD,CAAS,CACVf,QAAQ,CAACe,GAAD,CAAR,CACD,CALD,sEAKG,kMACiBT,CAAAA,UAAU,CAACU,cAAX,EADjB,QACKf,GADL,eAEKgB,SAFL,CAEiB,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAFjB,uBAG8B1B,CAAAA,gBAAgB,CAAC2B,UAAjB,CAA4B,OAA5B,EAAqCC,GAArC,CAAyClB,aAAzC,EAAwDmB,GAAxD,EAH9B,QAGKC,eAHL,eAG6FC,IAH7F,GAIKC,MAJL,CAIcF,eAAe,CAACE,MAJ9B,CAKDC,OAAO,CAACC,GAAR,CAAYJ,eAAZ,EALC,uBAMK9B,CAAAA,gBAAgB,CAAC2B,UAAjB,CAA4B,OAA5B,EAAqCC,GAArC,CAAyClB,aAAzC,EAAwDyB,GAAxD,CAA4D,CAChEH,MAAM,8BAAMA,MAAN,GAAe,CAACxB,GAAG,CAAHA,GAAD,CAAKgB,SAAS,CAATA,SAAL,CAAf,EAD0D,CAA5D,CANL,SAUDf,MAAM,CAACD,GAAD,CAAN,CAVC,uDALH,IAiBD,CArBS,CAqBP,CAACL,IAAD,CArBO,CAAT,CAuBD,MAAO,CAAEC,QAAQ,CAARA,QAAF,CAAYI,GAAG,CAAHA,GAAZ,CAAiBF,KAAK,CAALA,KAAjB,CAAP,CACD,CA9BD,CAgCA,cAAeJ,CAAAA,UAAf","sourcesContent":["import { useState, useEffect } from 'react';\nimport { projectStorage, projectFirestore, auth } from '../firebase';\n\nconst useStorage = (file) => {\n  const [progress, setProgress] = useState(0);\n  const [error, setError] = useState(null);\n  const [url, setUrl] = useState(null);\n\n  //uoploads the image to the Firebase Storage \n   useEffect(() => {\n    const currentUserId = auth.currentUser.uid\n    const storageRef = projectStorage.ref(file.name);\n   \n    storageRef.put(file).on('state_changed', (snap) => {\n      let percentage = (snap.bytesTransferred / snap.totalBytes) * 100;\n      setProgress(percentage);\n    }, (err) => {\n      setError(err);\n    }, async () => {\n      const url = await storageRef.getDownloadURL();\n      const createdAt = new Date().getTime();\n      const currentUserData = (await projectFirestore.collection('users').doc(currentUserId).get()).data();\n      const images = currentUserData.images\n      console.log(currentUserData)\n      await projectFirestore.collection('users').doc(currentUserId).set({\n        images: [...images,  {url,createdAt } ]\n      \n    })\n      setUrl(url);\n    });\n  }, [file]);\n\n  return { progress, url, error };\n}\n\nexport default useStorage;\n"]},"metadata":{},"sourceType":"module"}